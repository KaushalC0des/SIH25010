<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smart Crop Recommendation</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com?plugins=typography"></script>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Custom CSS -->
  <link rel="stylesheet" href="css/crop_rec.css">

  <!-- Showdown (Markdown to HTML) -->
  <script src="https://cdn.jsdelivr.net/npm/showdown@2.1.0/dist/showdown.min.js"></script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

  <div class="container mx-auto max-w-4xl bg-white rounded-2xl shadow-xl p-8 md:p-12 space-y-8">
    
    <!-- Form Section -->
    <div>
      <h1 class="text-3xl font-bold text-gray-800 mb-2">Smart Crop Recommendation</h1>
      <p class="text-gray-600 mb-8">Please provide details about your farm to receive tailored crop recommendations.</p>
      
      <form id="recommendationForm" class="space-y-6">
        
        <!-- Row 1 -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label for="farmerName" class="block text-sm font-medium text-gray-700">Farmer Name</label>
            <input type="text" id="farmerName" name="farmerName" placeholder="Enter your name" required
              class="input-field">
          </div>
          <div>
            <label for="farmLocation" class="block text-sm font-medium text-gray-700">Farm Location</label>
            <input type="text" id="farmLocation" name="farmLocation" placeholder="City, State/Province, Country" required
              class="input-field">
          </div>
        </div>

        <!-- Row 2 -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label for="farmSize" class="block text-sm font-medium text-gray-700">Farm Size</label>
            <select id="farmSize" name="farmSize" class="input-field" required>
              <option value="" disabled selected>Select farm size</option>
              <option value="small">Small (Less than 5 acres)</option>
              <option value="medium">Medium (5 - 20 acres)</option>
              <option value="large">Large (More than 20 acres)</option>
            </select>
          </div>
          <div>
            <label for="soilType" class="block text-sm font-medium text-gray-700">Soil Type</label>
            <select id="soilType" name="soilType" class="input-field" required>
              <option value="" disabled selected>Select soil type</option>
              <option value="loam">Loam</option>
              <option value="sandy">Sandy</option>
              <option value="clay">Clay</option>
              <option value="silt">Silt</option>
            </select>
          </div>
        </div>

        <!-- Row 3 -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label for="climateZone" class="block text-sm font-medium text-gray-700">Climate Zone</label>
            <select id="climateZone" name="climateZone" class="input-field" required>
              <option value="" disabled selected>Select climate</option>
              <option value="tropical">Tropical</option>
              <option value="temperate">Temperate</option>
              <option value="arid">Arid</option>
              <option value="subtropical">Subtropical</option>
            </select>
          </div>
          <div>
            <label for="waterAvailability" class="block text-sm font-medium text-gray-700">Water Availability</label>
            <select id="waterAvailability" name="waterAvailability" class="input-field" required>
              <option value="" disabled selected>Select water source</option>
              <option value="rainfed">Rainfed</option>
              <option value="irrigation">Irrigation</option>
              <option value="both">Both</option>
            </select>
          </div>
        </div>

        <!-- Row 4 -->
        <div>
          <label for="budgetRange" class="block text-sm font-medium text-gray-700">Budget Range</label>
          <select id="budgetRange" name="budgetRange" class="input-field" required>
            <option value="" disabled selected>Select budget range</option>
            <option value="low">Low</option>
            <option value="medium">Medium</option>
            <option value="high">High</option>
          </select>
        </div>

        <!-- Row 5 -->
        <div>
          <label for="previousCrops" class="block text-sm font-medium text-gray-700">Previous Crops (Optional)</label>
          <textarea id="previousCrops" name="previousCrops" placeholder="List crops grown in past 2-3 years..." rows="4" class="input-field"></textarea>
        </div>

        <!-- Submit Button -->
        <div class="flex justify-center">
          <button type="submit" class="btn-submit">
            Get Crop Recommendations <span class="ml-2">üå±</span>
          </button>
        </div>
      </form>
    </div>

    <!-- Recommendation Display Section -->
    <div id="recommendationOutput" class="space-y-4"></div>

    <!-- Loading Indicator -->
    <div id="loadingIndicator" class="hidden flex justify-center items-center mt-8">
      <svg class="animate-spin h-8 w-8 text-green-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
      </svg>
      <span class="ml-4 text-gray-600">Generating recommendations...</span>
    </div>

  </div>

  <!-- JS Script -->
  <script>
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('recommendationForm');
    const outputDiv = document.getElementById('recommendationOutput');
    const loadingIndicator = document.getElementById('loadingIndicator');

    form.addEventListener('submit', async (event) => {
      event.preventDefault();

      // Show loading indicator and clear previous output
      loadingIndicator.classList.remove('hidden');
      outputDiv.innerHTML = '';

      // Collect form data
      const formData = new FormData(form);
      const data = Object.fromEntries(formData.entries());

      const farmerName = data.farmerName || 'Farmer';
      const farmLocation = data.farmLocation || 'unspecified location';
      const farmSize = data.farmSize || 'unspecified size';
      const soilType = data.soilType || 'unspecified soil type';
      const climateZone = data.climateZone || 'unspecified climate zone';
      const waterAvailability = data.waterAvailability || 'unspecified water source';
      const budgetRange = data.budgetRange || 'unspecified budget';
      const previousCrops = data.previousCrops || 'no previous crops';

      // ‚ö†Ô∏è Replace with your backend API endpoint
      const apiKey = "AIzaSyBnBGCxucZj0edDvVZxusnW1c0nLDoQvyA";  
      const apiUrl = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=" + apiKey;

      const systemPrompt = "You are an AI assistant specialized in agricultural science and crop management. Provide expert crop recommendations based on the user's farming details. Format your response clearly with headings and bullet points.";

      const userQuery = "Based on the following details, recommend suitable crops and explain why they are a good fit: \n" +
        "- Farmer Name: " + farmerName + "\n" +
        "- Farm Location: " + farmLocation + "\n" +
        "- Farm Size: " + farmSize + "\n" +
        "- Soil Type: " + soilType + "\n" +
        "- Climate Zone: " + climateZone + "\n" +
        "- Water Availability: " + waterAvailability + "\n" +
        "- Budget Range: " + budgetRange + "\n" +
        "- Previous Crops: " + previousCrops + "\n\n" +
        "Provide the response in Markdown format with headings and bullet points.";

      const payload = {
        contents: [{ parts: [{ text: userQuery }] }],
        systemInstruction: { parts: [{ text: systemPrompt }] },
      };

      try {
        const response = await fetch(apiUrl, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        if (!response.ok) {
          throw new Error('HTTP error! status: ${response.status}');
          throw new Error("HTTP error! status: " + response.status);
        }

        const result = await response.json();
        const recommendation = result?.candidates?.[0]?.content?.parts?.[0]?.text;

        if (recommendation) {
          const converter = new showdown.Converter();
          const html = converter.makeHtml(recommendation);
          outputDiv.innerHTML =
            '<div class="bg-green-50 p-6 rounded-xl shadow-inner space-y-4">' +
            '<h2 class="text-2xl font-semibold text-green-800">Your Crop Recommendations</h2>' +
            '<div class="prose prose-green max-w-none">' + html + '</div>' +
            '</div>';
        } else {
          outputDiv.innerHTML = '<p class="text-red-500">Sorry, something went wrong. Please try again.</p>';
        }
      } catch (error) {
        console.error("Error fetching recommendations:", error);
        outputDiv.innerHTML = '<p class="text-red-500">Error: ' + error.message + '</p>';
      } finally {
        loadingIndicator.classList.add('hidden');
      }
    });
  });
  </script>
</body>
</html>
